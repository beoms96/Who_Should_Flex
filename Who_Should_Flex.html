<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <script type="text/javascript">

        var dx = Math.floor(Math.random() * 13) + 1; // speed of ball (1 ~ 13)
    
        var isStarted = false; // before game start : false, after game start : true
        var ballMove; // variable that saves interval
        var score; // final Score

        var NUMBER_FUNCTION_IS_EXECUTED = 0; // number of how many time does interval execute
        var isHide = false; //boolean variable to check status of hiding

        window.addEventListener('load', operate, false);

        function operate() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');

            var canvasWidth = window.innerWidth;
            var canvasHeight = window.innerHeight;

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight; 

            var r = window.innerWidth/25; //radius Of Ball
            var centerX = window.innerWidth/2; //X point of ball's center point
            var centerY = window.innerHeight/2; //Y point of ball's center point


            setFontSize(30);
            ctx.fillText("Click on the screen to start", canvasWidth/2, canvasHeight/2);

            canvas.addEventListener('mousedown', function (e) {
                if (!isStarted)
                    loopStart();
                else if (isStarted && isHide)
                    loopStop();
            }, false);

            canvas.addEventListener('touchstart', function(e){
                if (!isStarted)
                    loopStart();
                else if (isStarted && isHide)
                    loopStop();
            })

            function start() {
                ctx.clearRect(0, 0, canvasWidth, canvasHeight); // Erase all

                setFontSize(30);
                ctx.fillText("Click on the screen to stop", canvasWidth / 2, canvasHeight / 4);

                drawXasis();
                drawYasis();

                if (NUMBER_FUNCTION_IS_EXECUTED <= 800) { // 8 secs before hide
                   drawBall();
                }

                if (NUMBER_FUNCTION_IS_EXECUTED >= 800) // after 8 secs, isHide becomes true
                    isHide = true;

                if (NUMBER_FUNCTION_IS_EXECUTED >= 500) { // rectangle to hide balls
                    ctx.fillStyle = '#000000';
                    if (NUMBER_FUNCTION_IS_EXECUTED <= 800)
                        ctx.fillRect(0, canvasHeight / 5 * 2, canvasWidth, (NUMBER_FUNCTION_IS_EXECUTED - 500) / 500 / 3 * canvasHeight) 
                    else
                        ctx.fillRect(0, canvasHeight / 5 *2, canvasWidth, canvasHeight / 5 * 1);
                }

                NUMBER_FUNCTION_IS_EXECUTED++;

                if (centerX > (canvasWidth - r) || centerX < r) // if ball touches side of the canvas, ball changes its direction 
                    dx = -dx;

                centerX = centerX + dx;
            }

            function loopStart() { // function to start recursion
                isStarted = true;
                ballMove = setInterval(start, 10);
            }

            function loopStop() {
                clearInterval(ballMove);
                ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            
                setFontSize(30);
                ctx.fillText("Your Score", canvasWidth/2, canvasHeight/5);

                setFontSize(50);
                findScore();
                ctx.fillText(String(score) + "%", canvasWidth/2, canvasHeight * 4 /5);

                drawXasis();
                drawYasis()
                drawBall();
            }

            function drawXasis() { // X- axis line
            ctx.beginPath();
            ctx.moveTo(0, canvasHeight / 2);
            ctx.lineTo(canvasWidth, canvasHeight / 2);
            ctx.closePath();
            ctx.strokeStyle = 'black';
            ctx.stroke();
        }

        function drawYasis() { // y - axis line
            ctx.beginPath();
            ctx.moveTo(canvasWidth / 2, canvasHeight / 2 - canvasHeight/10);
            ctx.lineTo(canvasWidth / 2, canvasHeight / 2 + canvasHeight/10);
            ctx.closePath();
            ctx.strokeStyle = "#BBBBBB";
            ctx.stroke();
        }

        function drawBall() {
            ctx.beginPath(); //ball
            ctx.arc(centerX, centerY, r, 0, Math.PI * 2, false);
            ctx.fillStyle = '#FFAA00';
            ctx.fill();
            ctx.strokeStyle = '#FFAA00';
            ctx.stroke();
            ctx.closePath();

        }

        function setFontSize(size) {
            ctx.font = String(size) + 'px 고딕';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
        }

        function findScore() {
            score = 100 - Math.floor(((Math.abs(canvasWidth/2 - centerX)) / (canvasWidth/2) * 100));
        }
    }
    </script>
</head>

<body>
    <canvas id="canvas" width = 100% height= 100% >
      Your browser does not support the HTML 5 Canvas.
    </canvas>
</body>

</html>